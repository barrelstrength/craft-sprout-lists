{% extends 'sproutlists/_layouts/base' %}
{% import '_includes/forms' as forms %}

{% set crumbs = [
	{ label: "Subscribers"|t, url: url('sproutlists/subscribers') }
] %}

{% set title = subscriber.id is not null ? 'Edit Subscriber'|t : 'New Subscriber'|t %}

{% set selectedTab    = 'lists' %}

{% if subscriber is null %}
	{% exit 404 %}
{% endif %}

{% set fullPageForm = true %}

{% set saveShortcutRedirect = 'sproutlists/subscribers/edit/' ~ subscriber.id %}

{% block saveButton %}
	<div class="buttons">
		<div class="btngroup submit">
			<input type="submit" class="btn submit" value="{{ 'Save'|t }}">

			<div class="btn submit menubtn"></div>
			<div class="menu">
				<ul>
					<li><a class="formsubmit" data-redirect="sproutlists/subscribers/edit/{id}">{{ "Save and continue editing"|t
							}}</a></li>
					<li><a class="formsubmit" data-redirect="sproutlists/subscribers/new">{{ "Save and add another"|t }}</a></li>
				</ul>
			</div>
		</div>
	</div>
{% endblock %}

{% block main %}
<div class="grid first" data-max-cols="3">
	<div class="item" data-position="left" data-min-colspan="2" data-max-colspan="3">
		<div class="pane">

		<input type="hidden" id="action" name="action" value="sproutLists/subscribers/saveSubscriber">
		<input type="hidden" id="redirect" name="redirect" value="sproutlists/subscribers/">

		{% if subscriber.id is not null %}
			<input type="hidden" id="id" name="sproutlists[id]" value="{{ subscriber.id }}">
		{% endif %}

		<section id="default-fields">

			{{ forms.textField({
				label: "Email"|t,
				name: 'sproutlists[email]',
				id: 'email',
				required: true,
				autofocus: true,
				value: subscriber is defined ? subscriber.email : null,
				errors: subscriber is defined and subscriber.hasErrors('email') ? subscriber.getErrors('email') : null
			}) }}

			{{ forms.textField({
				label: "First Name"|t,
				name: 'sproutlists[firstName]',
				id: 'firstName',
				value: subscriber is defined ? subscriber.firstName : null,
				errors: subscriber is defined and subscriber.hasErrors('firstName') ? subscriber.getErrors('firstName') : null
			}) }}

			{{ forms.textField({
				label: "Last Name"|t,
				name: 'sproutlists[lastName]',
				id: 'lastName',
				value: subscriber is defined ? subscriber.lastName : null,
				errors: subscriber is defined and subscriber.hasErrors('lastName') ? subscriber.getErrors('lastName') : null
			}) }}

		</section>

		</div>
	</div>

	<div class="item" data-position="right" data-colspan="1">
		<div class="pane meta">

			<div class="field">
				<div class="heading">
					<label>{{ "Lists"|t }}</label>
				</div>
				<div class="input">

				{% if listTypes|length %}

					{% for listType in listTypes %}
						{{ listType.getSubscriberListsHtml(subscriber.id) }}
					{% endfor %}

				{% else %}

					{{ "Add a <a href='{newListUrl}'>Subscriber List</a>."|t({
						newListUrl: cpUrl('sproutlists/lists/new')
					})|raw }}

				{% endif %}

				</div>
			</div>

			<div class="field">
				<div class="heading">&nbsp;</div>
				<div class="input">
				{% if subscriber.id is not null %}
					{% set statusInput %}
						<div class="right">
							<input
								type="button"
								class="btn small formsubmit"
								data-action="sproutLists/subscribers/deleteSubscriber"
								data-confirm="{{ 'Are you sure you want to delete this subscriber?'|t }}"
								data-redirect="sproutlists/subscribers"
								value="{{ 'Delete'|t }}">
						</div>
					{% endset %}

					{{ forms.field({
						label: '&nbsp;'
					}, statusInput) }}
				{% endif %}
				</div>
			</div>

		</div>
	</div>

</div>

{% endblock %}
